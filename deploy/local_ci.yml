version: "1"
description: "Lokalny pipeline CI dla scenariusza demo→paper i retrainingu"

tasks:
  setup:
    steps:
      - name: Instalacja zależności deweloperskich
        run: |
          python -m pip install --upgrade pip
          pip install -e .[dev]
  e2e-demo-paper:
    needs:
      - setup
    steps:
      - name: Uruchom test demo→paper
        run: |
          pytest -m e2e_demo_paper --maxfail=1 --disable-warnings
      - name: Archiwizuj raporty Markdown
        run: |
          mkdir -p reports/e2e
          mkdir -p logs/e2e
          find reports/e2e -maxdepth 1 -type f -print || true
  retraining-report:
    needs:
      - setup
    steps:
      - name: Uruchom testy retrainingu
        run: |
          pytest -m retraining tests/reporting/test_retraining_reporter.py --maxfail=1 --disable-warnings
      - name: Archiwizuj raporty retreningu
        run: |
          mkdir -p reports/retraining
          find reports/retraining -maxdepth 1 -type f -print || true
  desktop-installer:
    needs:
      - setup
    steps:
      - name: Zbuduj instalator desktopowy (profil linux)
        run: |
          python deploy/packaging/desktop_installer.py \
            --version ci \
            --platform linux \
            --profiles-dir deploy/packaging/profiles \
            --hook-source probe_keyring.py
      - name: Wylistuj artefakty instalatora
        run: |
          find var/dist/installers -maxdepth 2 -type f -print || true

artifacts:
  paths:
    - reports/e2e
    - logs/e2e
    - reports/retraining
    - var/dist/installers
